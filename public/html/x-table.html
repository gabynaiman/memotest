<polymer-element name='x-table' attributes='source caption'>

  <style>
    x-table table {
      border-collapse: collapse;
    }

    x-table table caption {
      font-variant: small-caps;
      font-weight: bold;
      font-size: larger;
    }

    x-table table th, x-table table td {
      border: 1px solid #000;
      padding: 0 3px;
    }
  </style>

  <template>
    <table>
      <caption>{{caption}}</caption>
      <thead>
        <tr>
          <template repeat='{{field in fields}}'>
            <th>{{field.label}}</th>
          </template>
        </tr>
      </thead>
      <template if='{{!isLoading}}'>
        <tbody>
          <template repeat='{{element in elements}}'>
            <tr>
              <template repeat='{{field in fields}}'>
                <td>{{element[field.name]}}</td>
              </template>
            </tr>
          </template>
        </tbody>
      </template>
    </table>
    <template if='{{isLoading}}'>
      Loading...
    </template>
    <template if='{{!isLoading}}'>
      <button type='button' on-click='{{loadData}}'>Reload</button>
    </template>
  </template>

  <script>
    (function() {
      function httpGet(url, callback) {
        var ajax = new XMLHttpRequest();
        ajax.open('GET', url, true);
        ajax.onload = callback;
        ajax.send();
      }

      Polymer('x-table', {
        ready: function() {
          this.fields = this.children.array().map(function(e){ 
            return {
              name: e.impl.attributes.name.value,
              label: (e.impl.attributes.label || e.impl.attributes.name).value
            };
          });
          this.elements = [];
          this.loadData();
        },

        loadData: function() {
          var self = this;
          self.isLoading = true;
          httpGet(self.source, function(e) {
            self.elements = JSON.parse(e.srcElement.responseText);
            self.isLoading = false;
          });
        }
      });
    })();
  </script>

</polymer-element>